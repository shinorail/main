<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Train-News 一覧 - 篠ノ井乗務区</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .news-item {
            border: 1px solid #ddd;
            padding: 20px;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            transition: 0.3s;
        }
        .news-item:hover {
            border-color: #004da0;
            background: #f0f7ff;
            transform: translateY(-3px);
        }
        .news-no {
            background: #004da0;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            margin-right: 10px;
            font-weight: bold;
            font-size: 0.85em;
        }
        .news-title {
            display: block;
            font-weight: bold;
            color: #004da0;
            margin: 10px 0;
        }

        /* PDFプレビュー用モーダル */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }
        .modal-content {
            width: 90%;
            height: 85%;
            background: white;
            position: relative;
            border-radius: 8px;
            overflow: hidden;
        }
        .modal-close {
            align-self: flex-end;
            margin-right: 5%;
            color: white;
            font-size: 30px;
            cursor: pointer;
            padding: 10px;
        }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
</head>
<body>

<header></header>
<nav></nav>

<div class="container">
    <h2>Train-News（サイト内新聞）</h2>
    <p>見たい記事をクリックすると、その場で新聞を閲覧できます。</p>
    
    <div id="loading">新聞データを連結中...</div>
    <div id="news-list" class="news-grid"></div>
</div>

<div id="pdf-modal" class="modal">
    <span class="modal-close" onclick="closeModal()">× 閉じる</span>
    <div class="modal-content">
        <iframe id="pdf-viewer" src=""></iframe>
    </div>
</div>

<footer></footer>

<script src="menu.js"></script>
<script>
    const scriptUrl = "https://script.google.com/macros/s/AKfycbwbUTBxVeTkRlAJ1dnBlgcmpGaWI9B0SeMwkwKSwAJYjRDAtVcX67QwA5FcNGaJE9Cq/exec";

    async function loadTrainNews() {
        try {
            const response = await fetch(scriptUrl + "?sheet=新聞");
            const data = await response.json();
            document.getElementById('loading').style.display = 'none';
            const list = document.getElementById('news-list');

            data.reverse().forEach(item => {
                const div = document.createElement('div');
                div.className = 'news-item';
                // クリックでPDFを表示する関数を呼ぶ
                div.onclick = () => openModal(item.URL);
                
                div.innerHTML = `
                    <div class="news-meta">
                        <span class="news-no">${item.号数}</span>
                        <span style="font-size:0.85em;color:#666;">${item.日付}</span>
                    </div>
                    <span class="news-title">${item.タイトル}</span>
                    <p style="font-size:0.9em;color:#444;">${item.概要}</p>
                `;
                list.appendChild(div);
            });
        } catch (e) {
            document.getElementById('loading').innerText = "取得失敗";
        }
    }

    function openModal(url) {
        document.getElementById('pdf-viewer').src = url;
        document.getElementById('pdf-modal').style.display = 'flex';
        document.body.style.overflow = 'hidden'; // 背景スクロール禁止
    }

    function closeModal() {
        document.getElementById('pdf-modal').style.display = 'none';
        document.getElementById('pdf-viewer').src = "";
        document.body.style.overflow = 'auto'; // スクロール再開
    }

    loadTrainNews();
</script>
</body>
</html>
