<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ›ãƒ¼ãƒ  - ç¯ ãƒäº•ä¹—å‹™åŒº</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#004da0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link rel="icon" href="1.jpg" type="image/jpeg">
    <link rel="apple-touch-icon" href="1.jpg">
    
    <link rel="stylesheet" href="style.css">
    <style>
        /* indexå°‚ç”¨ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .omikuji-box {
            background: linear-gradient(135deg, #fff5f5 0%, #fff0f0 100%);
            border: 2px solid #d32f2f;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            text-align: center;
        }
        .omikuji-box h3 { color: #d32f2f; margin-top: 0; }
        .btn-omikuji {
            display: inline-block;
            background-color: #d32f2f;
            color: white;
            padding: 10px 20px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            margin-top: 10px;
        }
        .sns-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 5px solid #2196f3;
        }
        /* ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
        #survey-container {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .survey-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            position: relative;
        }
    </style>
</head>
<body>

    <header></header>
    <nav></nav>

    <main class="container">
        <section class="omikuji-box">
            <h3>ä»Šæ—¥ã®é‹å‹¢ã‚’ãƒã‚§ãƒƒã‚¯</h3>
            <p>ç¯ ãƒäº•ä¹—å‹™åŒº é‰„é“ãŠã¿ãã˜</p>
            <div id="omikuji-result" style="font-size: 1.5em; font-weight: bold; margin: 15px 0; min-height: 1.6em;"></div>
            <button onclick="drawOmikuji()" class="btn-omikuji">ãŠã¿ãã˜ã‚’å¼•ã</button>
        </section>

        <section>
            <h2>ç¯ ãƒäº•ä¹—å‹™åŒºã¸ã‚ˆã†ã“ã</h2>
            <p>ä¿¡å·ã®é‰„é“æ–‡åŒ–ã¨ã€ç¾å ´ã®ç†±æ„ã‚’ä¼ãˆã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€‚ç§ãŸã¡ã¯é‰„é“ã®è¨˜éŒ²ã¨ç¶™æ‰¿ã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚</p>
            
            <div class="sns-info">
                <strong>ã€å…¬å¼SNSã€‘</strong> æœ€æ–°æƒ…å ±ã¯ Xï¼ˆæ—§Twitterï¼‰ã«ã¦ç™ºä¿¡ä¸­ã§ã™ã€‚
            </div>
        </section>

        <section style="margin-top: 40px; text-align: center;">
            <button onclick="toggleSurvey()" style="background:#004da0; color:white; border:none; padding:15px 25px; border-radius:30px; cursor:pointer; font-weight:bold;">
                ğŸ“‹ ã‚µã‚¤ãƒˆæ”¹å–„ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ã”å”åŠ›ãã ã•ã„
            </button>
        </section>
    </main>

    <div id="survey-container">
        <div class="survey-card">
            <button onclick="toggleSurvey()" style="position:absolute; right:15px; top:10px; background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
            <h3>ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</h3>
            <form id="survey-form">
                <p>ã“ã®ã‚µã‚¤ãƒˆã®ä½¿ã„ã‚„ã™ã•ã¯ï¼Ÿ</p>
                <label><input type="radio" name="s-rate" value="æº€è¶³" required> æº€è¶³</label>
                <label><input type="radio" name="s-rate" value="æ™®é€š"> æ™®é€š</label>
                <label><input type="radio" name="s-rate" value="ä¸æº€"> ä¸æº€</label>
                <p>ã”æ„è¦‹ãƒ»ã”è¦æœ›</p>
                <textarea id="s-msg" style="width:100%; height:80px; margin-bottom:15px;"></textarea>
                <button type="submit" id="s-btn" style="width:100%; background:#004da0; color:white; border:none; padding:12px; border-radius:5px; font-weight:bold;">é€ä¿¡ã™ã‚‹</button>
            </form>
            <div id="s-thanks" style="display:none; text-align:center; padding:20px;">
                <h4>é€ä¿¡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼</h4>
            </div>
        </div>
    </div>

    <footer></footer>

    <script src="menu.js"></script>
    <script>
        // PWA ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ã®ç™»éŒ²
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(reg => console.log('PWA Service Worker ç™»éŒ²æˆåŠŸ'))
                    .catch(err => console.log('PWA ç™»éŒ²å¤±æ•—', err));
            });
        }

        const scriptUrl = "https://script.google.com/macros/s/AKfycbwbUTBxVeTkRlAJ1dnBlgcmpGaWI9B0SeMwkwKSwAJYjRDAtVcX67QwA5FcNGaJE9Cq/exec";

        // ãŠã¿ãã˜æ©Ÿèƒ½
        function drawOmikuji() {
            const results = [
                "å¤§å‰ï¼šç‰¹æ€¥ã‚ãšã•ã®ã‚ˆã†ã«çµ¶å¥½èª¿ï¼",
                "ä¸­å‰ï¼šå„é§…åœè»Šã§ã‚†ã£ãã‚Šé€²ã‚ã°å‰ã€‚",
                "å°å‰ï¼šãƒªã‚¾ãƒ¼ãƒˆãƒ“ãƒ¥ãƒ¼ãµã‚‹ã•ã¨ã§ç™’ã‚„ã•ã‚Œã‚ˆã†ã€‚",
                "å‰ï¼šç¯ ãƒäº•ç·šçµŒç”±ã§ç›®çš„åœ°ã¸é †èª¿ï¼",
                "æœ«å‰ï¼šå®‰å…¨ç¬¬ä¸€ã§æŒ‡å·®ã—ç¢ºèªã‚’å¿˜ã‚Œãšã«ã€‚"
            ];
            const result = results[Math.floor(Math.random() * results.length)];
            document.getElementById('omikuji-result').innerText = result;
        }

        // ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—åˆ¶å¾¡
        function toggleSurvey() {
            const p = document.getElementById('survey-container');
            p.style.display = (p.style.display === 'flex') ? 'none' : 'flex';
        }

        // ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆé€ä¿¡
        document.getElementById('survey-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('s-btn');
            btn.disabled = true; btn.innerText = "é€ä¿¡ä¸­...";
            
            const data = {
                name: "åŒ¿å",
                rating: document.querySelector('input[name="s-rate"]:checked').value,
                message: document.getElementById('s-msg').value || "ï¼ˆæœªå…¥åŠ›ï¼‰"
            };

            try {
                await fetch(scriptUrl, { method: 'POST', body: JSON.stringify(data) });
                document.getElementById('survey-form').style.display = 'none';
                document.getElementById('s-thanks').style.display = 'block';
                setTimeout(() => {
                    toggleSurvey();
                    setTimeout(() => {
                        document.getElementById('survey-form').style.display = 'block';
                        document.getElementById('s-thanks').style.display = 'none';
                        btn.disabled = false; btn.innerText = "é€ä¿¡ã™ã‚‹";
                        document.getElementById('survey-form').reset();
                    }, 500);
                }, 3000);
            } catch (e) {
                alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                btn.disabled = false; btn.innerText = "é€ä¿¡ã™ã‚‹";
            }
        });
    </script>
</body>
</html>
