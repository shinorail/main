<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒ›ãƒ¼ãƒ  - ç¯ ãƒäº•ä¹—å‹™åŒº</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1a1a1a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="icon-192.png">

<link rel="stylesheet" href="style.css">

<style>
/* ===== indexå°‚ç”¨ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆå…ƒUIåŸºæº–ï¼‰ ===== */
.omikuji-box{
  background:linear-gradient(135deg,#fff5f5,#fff0f0);
  border:2px solid #d32f2f;
  padding:20px;
  border-radius:10px;
  margin-bottom:30px;
  text-align:center;
}
.omikuji-box h3{color:#d32f2f;margin-top:0}
.btn-omikuji{
  background:#d32f2f;
  color:#fff;
  padding:10px 20px;
  border-radius:5px;
  text-decoration:none;
  font-weight:bold;
  display:inline-block;
}

.sns-info{
  background:#e3f2fd;
  padding:15px;
  border-radius:5px;
  border-left:5px solid #2196f3;
}

.link-grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
  gap:15px;
  margin-top:30px;
}
.link-card{
  background:#f0f0f0;
  padding:15px;
  text-align:center;
  text-decoration:none;
  color:#004da0;
  font-weight:bold;
  border-radius:5px;
}

/* ===== ãŠçŸ¥ã‚‰ã›è¡¨ç¤ºç”¨ã‚¹ã‚¿ã‚¤ãƒ« ===== */
#top-news-list { list-style: none; padding: 0; }
.top-news-item { border-bottom: 1px solid #eee; padding: 10px 0; font-size: 14px; }
.info-tag { font-size: 10px; padding: 2px 6px; border-radius: 3px; color: #fff; margin-right: 8px; background: #004da0; }
.tag-red { background: #d00; }
.tag-green { background: #080; }

/* ===== ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ ===== */
.survey-toggle{
  position:fixed;
  bottom:20px;
  right:20px;
  background:#004da0;
  color:#fff;
  padding:12px 20px;
  border-radius:30px;
  font-weight:bold;
  cursor:pointer;
  z-index:1000;
}
.survey-popup{
  position:fixed;
  bottom:80px;
  right:20px;
  width:300px;
  background:#fff;
  border-radius:10px;
  box-shadow:0 5px 20px rgba(0,0,0,.2);
  display:none;
  flex-direction:column;
  z-index:1000;
}
.survey-header{
  background:#004da0;
  color:#fff;
  padding:10px;
  display:flex;
  justify-content:space-between;
}
.survey-body{padding:15px}
.s-rating{display:flex;gap:5px;margin-bottom:10px;}
.s-rating input{display:none}
.s-rating label{
  flex:1;
  text-align:center;
  background:#eee;
  padding:8px 0;
  border-radius:4px;
  cursor:pointer;
}
.s-rating input:checked+label{
  background:#004da0;
  color:#fff;
}
.s-submit{
  width:100%;
  background:#004da0;
  color:#fff;
  border:none;
  padding:12px;
  border-radius:4px;
  font-weight:bold;
  cursor:pointer;
}
#msg { width:100%; box-sizing:border-box; margin-bottom:10px; padding:8px; }

/* ===== æ›´æ–°é€šçŸ¥ ===== */
.update-toast{
  position:fixed;
  bottom:20px;
  left:50%;
  transform:translateX(-50%);
  background:#323232;
  color:#fff;
  padding:14px 20px;
  border-radius:30px;
  font-size:14px;
  display:none;
  z-index:2000;
}
</style>
</head>

<body>

<header></header>
<nav></nav>

<div class="container">

<section class="omikuji-box">
  <h3 id="txt-omikuji-title">ã€2å‘¨å¹´è¨˜å¿µã€‘é‰„é“ãŠã¿ãã˜ å…¬é–‹çµ‚äº†ã—ã¾ã—ãŸã€‚</h3>
  <p id="txt-omikuji-note">2026å¹´1æœˆ31æ—¥ã§å…¬é–‹çµ‚äº†ã—ã¾ã—ãŸ<p>
</section>

<p id="txt-welcome">
  ã‚ˆã†ã“ãã€ç¯ ãƒäº•ä¹—å‹™åŒºã®å…¬å¼ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ã¸ã€‚
</p>

<section class="sns-info">
  <strong>â—‡ æœ€æ–°æƒ…å ±ã¯ Xï¼ˆæ—§Twitterï¼‰ã§ç™ºä¿¡ä¸­</strong><br>
  <a href="https://x.com/Shino_Rail" target="_blank">@Shino_Rail</a>
</section>

<section style="margin-top:40px">
  <h3>æœ€æ–°ã®ãŠçŸ¥ã‚‰ã›</h3>
  <p id="news-loading">èª­ã¿è¾¼ã¿ä¸­...</p>
  <ul id="top-news-list" class="notranslate"></ul>
  <div style="text-align:right;font-size:13px">
    <a href="news.html">ãŠçŸ¥ã‚‰ã›ä¸€è¦§ã¸</a>
  </div>
</section>

<div class="link-grid">
  <a class="link-card" href="mission.html">â–¶ æ´»å‹•ç†å¿µã‚’è¦‹ã‚‹</a>
  <a class="link-card" href="history.html">â–¶ æ²¿é©ã‚’è¦‹ã‚‹</a>
  <a class="link-card" href="news.html">â–¶ ãŠçŸ¥ã‚‰ã›ã‚’è¦‹ã‚‹</a>
</div>

</div>

<div id="survey-toggle" class="survey-toggle" onclick="toggleSurvey()">ğŸ“© ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå”åŠ›</div>

<div id="survey-container" class="survey-popup">
  <div class="survey-header">
    <span>é–²è¦§è€…ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ</span>
    <button onclick="toggleSurvey()">Ã—</button>
  </div>

  <form id="survey-form" class="survey-body">
    <div class="s-rating">
      <input id="r1" type="radio" name="rate" value="1"><label for="r1">1</label>
      <input id="r2" type="radio" name="rate" value="2"><label for="r2">2</label>
      <input id="r3" type="radio" name="rate" value="3" checked><label for="r3">3</label>
      <input id="r4" type="radio" name="rate" value="4"><label for="r4">4</label>
      <input id="r5" type="radio" name="rate" value="5"><label for="r5">5</label>
    </div>
    <textarea id="msg" rows="3" placeholder="ã”è‡ªç”±ã«ãŠæ›¸ããã ã•ã„"></textarea>
    <button type="submit" class="s-submit" id="survey-btn">é€ä¿¡ã™ã‚‹</button>
  </form>

  <div id="survey-thanks" style="display:none;padding:20px;text-align:center">
    <strong>ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚</strong><br>
    <small>ä»Šå¾Œã¨ã‚‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚ã€‚</small>
  </div>
</div>

<div id="update-toast" class="update-toast">
  æ–°ã—ã„æ›´æ–°ãŒã‚ã‚Šã¾ã™ã€‚ã¾ã‚‚ãªãåæ˜ ã•ã‚Œã¾ã™ã€‚
</div>

<footer></footer>

<script src="menu.js"></script>

<div id="google_translate_element" style="display:none"></div>
<script>
function googleTranslateElementInit() {
  new google.translate.TranslateElement(
    { pageLanguage:'ja', includedLanguages:'ja,en', autoDisplay:false },
    'google_translate_element'
  );
}
</script>
<script src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

<script>
/* ===== å®šæ•°ãƒ»è¨­å®š ===== */
const scriptUrl = "https://script.google.com/macros/s/AKfycbwbUTBxVeTkRlAJ1dnBlgcmpGaWI9B0SeMwkwKSwAJYjRDAtVcX67QwA5FcNGaJE9Cq/exec";

/* ===== ãŠçŸ¥ã‚‰ã›èª­ã¿è¾¼ã¿æ©Ÿèƒ½ ===== */
async function loadTopNews() {
    const list = document.getElementById('top-news-list');
    const loading = document.getElementById('news-loading');
    try {
        const res = await fetch(scriptUrl + "?sheet=ãŠçŸ¥ã‚‰ã›");
        const data = await res.json();
        
        if (loading) loading.style.display = 'none';
        list.innerHTML = "";
        
        if (!data || data.length === 0 || data.error) {
            list.innerHTML = "<li>ç¾åœ¨ãŠçŸ¥ã‚‰ã›ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</li>";
            return;
        }

        data.reverse().slice(0, 3).forEach(item => {
            const li = document.createElement('li');
            li.className = 'top-news-item';
            
            let tagClass = "";
            if(item['ã‚¿ã‚°'] === "æ›´æ–°") tagClass = "tag-red";
            if(item['ã‚¿ã‚°'] === "è¡Œäº‹") tagClass = "tag-green";

            li.innerHTML = `
                <span class="info-date" style="color:#888; font-size:12px;">${item['æ—¥ä»˜'] || ""}</span><br>
                <span class="info-tag ${tagClass}">${item['ã‚¿ã‚°'] || "é‡è¦"}</span>
                <span class="info-title"><strong>${item['è¦‹å‡ºã—'] || "ç„¡é¡Œ"}</strong></span>
            `;
            list.appendChild(li);
        });
    } catch(e) {
        if (loading) loading.innerText = "ãŠçŸ¥ã‚‰ã›ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚";
    }
}

/* ===== ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆé€ä¿¡æ©Ÿèƒ½ ===== */
document.getElementById('survey-form').onsubmit = async (e) => {
    e.preventDefault();
    const btn = document.getElementById('survey-btn');
    btn.disabled = true;
    btn.innerText = "é€ä¿¡ä¸­...";

    const rate = document.querySelector('input[name="rate"]:checked').value;
    const msg = document.getElementById('msg').value;
    const name = localStorage.getItem("userName") || "ã‚²ã‚¹ãƒˆ";

    const payload = {
        action: "postSurvey",
        name: name,
        rating: rate,
        message: msg
    };

    try {
        await fetch(scriptUrl, { method: 'POST', body: JSON.stringify(payload) });
        document.getElementById('survey-form').style.display = 'none';
        document.getElementById('survey-thanks').style.display = 'block';
        setTimeout(() => toggleSurvey(), 3000);
    } catch(e) {
        alert("é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
        btn.disabled = false;
        btn.innerText = "é€ä¿¡ã™ã‚‹";
    }
};

/* ===== UIåˆ¶å¾¡æ©Ÿèƒ½ï¼ˆã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼‰ ===== */
function toggleSurvey(){
  const s=document.getElementById('survey-container');
  s.style.display=s.style.display==='flex'?'none':'flex';
}

function surveyVisibility(){
  const btn = document.getElementById('survey-toggle');
  if(btn) btn.style.display = navigator.onLine ? 'block' : 'none';
}
window.addEventListener('online',surveyVisibility);
window.addEventListener('offline',surveyVisibility);
surveyVisibility();

/* ===== PWAãƒ»Service Workeré–¢é€£ ===== */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('./service-worker.js').then(reg => {
      console.log('PWA Ready');
      reg.addEventListener('updatefound', () => {
        const nw = reg.installing;
        nw.addEventListener('statechange', () => {
          if (nw.state === 'installed' && navigator.serviceWorker.controller) {
            showUpdate(nw);
          }
        });
      });
    }).catch(err => console.log('PWA Error', err));
  });
}

function showUpdate(waitingSW){
  if(window.innerWidth >= 768) return;
  const t = document.getElementById('update-toast');
  if(t) t.style.display = 'block';
  setTimeout(() => {
    if(waitingSW) waitingSW.postMessage({action: 'skipWaiting'});
    location.reload();
  }, 2000);
}

/* ===== å®Ÿè¡Œ ===== */
loadTopNews();
</script>

</body>
</html>
